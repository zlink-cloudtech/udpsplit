---
applyTo: "**"
description: 经过提炼的开发最佳实践原则，基于实际项目开发中的经验教训总结，开发过程中必须遵循的内容
---

# 开发最佳实践指导

> **详细说明文档**: `docs/DEVELOPMENT_BEST_PRACTICES.md`  
> 本文档包含完整的原理解释、案例分析和实施细节。

## 核心强制原则

## 核心强制原则

### 1. 渐进式开发 - 绝对强制

**执行要求**：
- 用户明确要求"逐步实施"时，必须严格遵循
- 从1-2个最简单功能开始，每个增量立即验证
- 禁止"大爆炸式"一次性完整开发

**立即执行**：
```
阶段1: 1个最简单场景 → 立即测试
阶段2: 添加1-2个新场景 → 立即测试  
阶段3: 扩展功能 → 立即测试
```

### 2. 测试驱动开发 - 同步必须

**强制循环**：
```
写少量代码 → 立即测试 → 修复问题 → 继续开发
```

**禁止模式**：
```
写大量代码 → 最后测试 → 发现大量问题 → 批量修复
```

### 3. 用户指导优先 - 绝对服从

**执行标准**：
- 严格按照用户方法论要求执行
- 不得用技术判断替代用户流程要求
- 用户的"逐步"要求具有最高优先级

### 4. 质量优于速度 - 不可妥协

**执行准则**：
- 宁可进度慢，确保每个增量质量
- 早期频繁验证比后期大量修复更有效
- 基础设施代码质量要求更高

### 5. 代码透明性 - 绝对诚实

**强制要求**：
- 使用TODO标记代替无效模拟代码
- 让失败快速暴露，不允许掩盖问题
- 禁止写看似有效但实际无用的模拟代码

**TODO标记格式**：
```python
# TODO-优先级: 简短描述
# 实现要求：具体做什么，预期结果
# 依赖：前置条件
raise NotImplementedError("具体待实现内容")
```

### 6. 路径管理规范 - 强制统一

**核心原则**：
- 禁止在测试文件中使用 `sys.path.append()`
- 路径配置必须在框架指定位置统一管理
- 遵循测试框架的导入约定和最佳实践

**强制配置位置**：
```
pytest测试: tests/conftest.py 中统一配置路径
BDD测试: tests/bdd/environment.py 中统一配置路径  
禁止位置: 步骤定义文件、测试用例文件中的路径配置
```

### 7. 规划任务时逐步深入，复杂任务需记录好上下文

**执行标准**：
- 先规划开发框架的任务，再逐步深入到模块和函数
- 每个开发任务后都紧跟一个验证任务，确保执行下个任务前，已实施的代码已可靠，避免故障指数迭代，难以修复
- 规划任务必须用TODO List工具记录好
- 对于复杂的任务可记录“任务所需上下文知识”，并在TODO List工具中记录好这个映射关系，当开始执行任务时需要读取对应上下文文件。

**强制记录上下文规范**：
- 记录上下文时，可创建`.tasks`目录，目录中的每文件对应一个任务，内容是任务说明和所需的上下文知识
- 上下文知识应当经过提炼，可直接用于实施任务的知识

### 8. 函数定义保持扁平 - 严格约束

**执行标准**：
- 禁止在函数内部嵌套定义其他函数，除非闭包不可避免且已在设计评审中确认
- 公共函数、工具函数必须在模块顶层定义，便于复用、测试和注释
- 当需要共享逻辑时，优先抽取独立私有函数或类方法

**违背后果**：
- 内嵌函数无法被单独测试或复用，导致逻辑重复和隐藏缺陷
- 调试和排查难度显著增加，破坏代码可读性和团队协同
- 容易掩盖作用域泄漏问题，引发闭包状态无法预测的技术债务

## 强制执行清单

### 每次提交前强制验证

- [ ] 代码正常运行，无语法错误
- [ ] 所有现有测试通过
- [ ] 无明显架构冲突
- [ ] 遵循项目编码规范
- [ ] 新增功能有对应测试
- [ ] 无分散的路径配置（sys.path.append）

### BDD开发专项检查

- [ ] 步骤定义无重复冲突
- [ ] 分层架构清晰正确
- [ ] `behave --dry-run`通过
- [ ] 场景有完整步骤支持

### 阶段性强制门禁

- [ ] 核心业务场景测试覆盖
- [ ] kind环境端到端测试通过
- [ ] 分层架构保持清晰
- [ ] 文档与实现同步

## 禁止行为

### 绝对禁止

1. **禁止大爆炸式开发**：一次性开发大量功能
2. **禁止延迟测试**：先写功能后补测试
3. **禁止违背用户指导**：用技术判断替代用户要求
4. **禁止无效模拟代码**：写看似有效但无用的代码
5. **禁止掩盖技术债务**：隐藏真实实现状态
6. **禁止分散路径管理**：在测试文件中使用sys.path.append

### 强制替代方案

- 大爆炸式开发 → 渐进式增量开发
- 延迟测试 → 测试驱动同步开发
- 技术判断优先 → 用户指导优先
- 无效模拟代码 → TODO标记透明化
- 掩盖问题 → 快速暴露失败
- 分散路径管理 → 框架统一配置

## 应急处理

### 发现违背最佳实践时

1. **立即停止**当前开发工作
2. **评估影响**范围和修复成本
3. **制定修复**计划，优先架构问题
4. **渐进式修复**，不要再次大爆炸
5. **吸取教训**，更新团队认知

### 技术债务发现时

1. **立即记录**债务详情和影响
2. **评估优先级**，关键债务立即修复
3. **制定偿还**计划，纳入开发排期
4. **预防措施**，避免类似债务产生

### 路径管理问题修复时

1. **立即停止**在测试文件中添加sys.path.append
2. **评估影响**范围，检查所有测试文件
3. **统一迁移**路径配置到framework指定位置：
   - pytest: 迁移到tests/conftest.py
   - behave: 迁移到tests/bdd/environment.py
4. **清理重复**，删除测试文件中的手动路径配置
5. **验证测试**，确保迁移后所有测试正常运行

## 成功标准

### 项目级成功指标

- [ ] 严格遵循用户方法论指导
- [ ] 渐进式开发无例外执行
- [ ] 测试覆盖率持续保持高水平
- [ ] 技术债务透明化管理
- [ ] 代码质量持续改进

### 团队级成功指标

- [ ] 团队成员理解并执行最佳实践
- [ ] 代码审查重点关注实践遵循
- [ ] 持续学习和改进文化建立
- [ ] 质量优先价值观深入人心